---
title: "Introduction to Xcertainty"
output: rmarkdown::html_vignette
description: >
  Start here to learn how to use Xcertainty. You'll learn how to include drone-based measurement data into the Bayesian statistical model to produce predective posterior distributions for each measurement.
vignette: >
  %\VignetteIndexEntry{Introduction to Xcertainty}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
date: "2024-03-27"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(Xcertainty)
```

TODOs: 
* [] create documentation for 'calibration' (i.e., column info, GEMM Lab as owner, etc.)
* [] create documentation for 'whales'
* [] need checks
  * convergence checks
  * [] rhat checks
  * [] autocorrelation checks
* interpretation functions
  * [] view summary results quickly and easily
  * [] quick plots
      - and you can use ggplot, but it might be helpful to have a function that saves lower and upper to use within ggplot, say geom_pointrage() or geom_ribbon() for growth curve.



All morphological measurements derived using drone-based photogrammetry are susceptible to uncertainty. This uncertainty often varies by the drone system used. Thus, it is critical to incorporate photogrammetric uncertainty associated with measurements collected using different drones so that results are robust and comparable across studies.

The Xcertainty package makes this simple and easy by producing a predictive posterior distribution for each measurement. This posterior distribution can be summarized to describe the measurement and it associated uncertainty (i.e., median, standard deviation), as well as to make probabilistic statements, such as classifying maturity and identifying pregnant individuals. 

Xcertainty is based off the Bayesian statistical model described in [Bierlich et al. (2021)](https://doi.org/10.3354/meps13814) where measurements of known-sized objects ('calibration objects') collected at various altitudes are used as training data to predict morphological measurements (such as body length) and associated uncertainty of unknown-sized objects (such as whales). 

In this vignette, we'll cover how to setup your data, run Xcertainty, and interpret output results. 


## Main inputs

Xcertainty has three main steps.  Each step has functions specific to the type of data:
1. Prepare calibration and observation data:
  * 'parse_observations()' parses wide-format data into a normalized list of data.frame objects. 
2. Choose sampler based on data:
  * 'calibration_sampler()' ---- []?
  * 'independent_length_sampler()' data contains individuals with neither replicate samples nor age information. 
  * 'nondecreasing_length_sampler()' data contains individuals with replicate samples but no age information. This sets rules so that length measurements of an individuals cannot shrink over time (from year to year). 
  * 'growth_curve_sampler()' data contains individuals with replicate samples and age information. This fits a Von Bertalanffy-Putter growth curve to observations following *Pirotta & Bierlich et al., in revision*.
3. Run! 
  * 'sampler()' set the number of iterations using 'niter'
  
  
First let's start with calibration data.


## Calibration data

### Calibration Data
We'll use a dataset consisting of measurements of a 1 m wooden board collected by five different drones at various altitudes (13-62 m). This dataset is documents in ?calibration. 
```{r}

#devtools::build_vignettes()
load(file.path('..', 'data', 'calibration.rda'))
#load(calibration)
range(calibration$Baro_Alt)
table(calibration$uas)
print(colnames(calibration))
```

### parse_observations()
Use parse_observations() to set up the calibration data.
```{r}
# parse calibration study
calibration_data = parse_observations(
  x = calibration, 
  subject_col = 'CO.ID',
  meas_col = 'Lpix', 
  tlen_col = 'CO.L', 
  image_col = 'image', 
  barometer_col = 'Baro_Alt',
  laser_col = 'Laser_Alt', 
  flen_col = 'Focal_Length', 
  iwidth_col = 'Iw', 
  swidth_col = 'Sw',
  uas_col = 'uas'
)
```


This creates a list of three dataframes.
$pixel_counts
$training_objects
$image_info
```{r}
head(calibration_data)
```


